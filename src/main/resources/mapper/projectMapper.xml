<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/schema/mybatis-3-mapper.dtd">
<mapper namespace="me.jhchoi.ontrack.mapper.ProjectMapper">
    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO ontrack_project(CREATOR, project_type, project_name, project_url, project_dueDate, project_status, createdAt, updatedAt)
        VALUES (#{creator}, #{projectType}, #{projectName}, #{projectUrl}, #{projectDueDate}, #{projectStatus}, #{createdAt}, #{updatedAt})
    </insert>

    <select id="findByProjectId" resultType="OnTrackProject">
        SELECT id, CREATOR, project_name, project_type, project_status, project_url, project_dueDate, createdAt, updatedAt
        FROM ontrack_project
        WHERE id = #{id}
    </select>

    <select id="allMyProjects" resultType="ProjectList">
        SELECT p.id as projectId, p.project_type, p.project_status, p.project_name, p.creator as creatorId, pm.nickname as creatorName, p.project_dueDate,p.createdAt, p.updatedAt
        FROM ontrack_project p INNER JOIN project_member pm
        ON p.id = pm.project_id
        WHERE p.id = #{id}
        AND pm.position = "creator"
    </select>

</mapper>